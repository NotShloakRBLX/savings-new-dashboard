<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,viewport-fit=cover" />
<title>Savings</title>
<style>
  :root{
    --bg:#0b0b0b;
    --card:#121213;
    --text:#fff;
    --muted:rgba(255,255,255,.66);
    --divider:rgba(255,255,255,.14);
    --shadow:0 14px 40px rgba(0,0,0,.45);
    --radius:16px;
    --btnLight:#fff;
    --t:.35s cubic-bezier(.2,.8,.2,1);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;background:var(--bg);color:var(--text);
    font:15px -apple-system,BlinkMacSystemFont,"SF Pro Text","SF Pro Display",Inter,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    -webkit-font-smoothing:antialiased;line-height:1.4;
  }
  .app{max-width:430px;height:100svh;margin:0 auto;position:relative;overflow:hidden}
  .views{display:flex;width:200%;height:100%;transition:transform var(--t)}
  .view{width:100%;height:100%;overflow:auto;background:linear-gradient(#0b0b0b,#0b0b0b 60%,#0a0a0a)}
  .view::-webkit-scrollbar{width:0;height:0}

  /* Header / Nav */
  .nav{
    position:sticky;top:0;z-index:5;display:flex;align-items:center;justify-content:space-between;
    padding:18px 14px 10px;background:linear-gradient(180deg,rgba(10,10,10,.95),rgba(10,10,10,.55) 40%,transparent);
    -webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px)
  }
  .title{font-size:34px;font-weight:800;letter-spacing:-.3px;margin:0}
  .iconrow{display:flex;gap:10px}
  .iconbtn{
    width:34px;height:34px;border-radius:999px;background:rgba(255,255,255,.06);
    border:1px solid var(--divider);display:grid;place-items:center;transition:transform var(--t);cursor:pointer
  }
  .iconbtn:active{transform:scale(.96)}

  /* Summary Card (click to expand) */
  .summary{
    margin:10px 12px 0;background:var(--card);border-radius:16px;
    box-shadow:var(--shadow);padding:16px;border:1px solid var(--divider);
    cursor:pointer;user-select:none;transition:border-radius .25s ease, box-shadow .25s ease;
  }
  .summary.open{border-bottom-left-radius:0;border-bottom-right-radius:0}
  .row{display:flex;align-items:flex-end;justify-content:space-between;gap:12px}
  .label{color:var(--muted);font-weight:800}
  .balance{font-size:32px;font-weight:900;line-height:1.1;margin-top:4px}
  .apy{font-weight:900;border-radius:12px;padding:8px 12px;background:#1b1b1d;border:1px solid var(--divider)}

  /* Dropdown panel */
  .acctPanel{
    margin:0 12px 12px;background:var(--card);border:1px solid var(--divider);
    border-top:none;border-radius:0 0 16px 16px;box-shadow:var(--shadow);
    overflow:hidden;max-height:0;opacity:.0;transform:translateY(-4px);
    transition:max-height .35s ease, opacity .25s ease, transform .35s ease;
  }
  .acctPanel.open{opacity:1;transform:translateY(0)}
  .acctInner{padding:12px 16px}
  .kv{display:flex;justify-content:space-between;align-items:center;padding:10px 0}
  .kv + .kv{border-top:1px solid var(--divider)}
  .kv .k{color:var(--muted);font-weight:800}
  .kv .v{font-weight:900;letter-spacing:.3px}

  /* Buttons */
  .actions{display:flex;gap:12px;margin:10px 12px 12px}
  .btn{flex:1;border-radius:14px;padding:14px 16px;font-weight:900;border:1px solid var(--divider);
       text-align:center;user-select:none;cursor:pointer}
  .btn.light{background:#1a1a1c;color:#fff}
  .btn.primary{background:var(--btnLight);color:#000;border-color:transparent}

  .accountBtn{
    width:86%;margin:4px auto 18px;padding:14px 16px;border-radius:14px;
    background:var(--card);border:1px solid var(--divider);box-shadow:var(--shadow);
    display:flex;align-items:center;justify-content:space-between;font-weight:900;
  }
  .accountBtn .right{opacity:.95}

  .sectionTitle{margin:10px 16px 8px;font-weight:900;font-size:20px}

  /* Transactions */
  .tile{margin:0 12px 14px;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.09);
        border-radius:14px;padding:12px}
  #txnList .txnRow{
    display:flex;gap:12px;align-items:center;border-radius:14px;padding:12px;cursor:pointer;
    background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.09);
  }
  #txnList .txnRow + .txnRow{margin-top:10px}
  .txnMain{flex:1}
  .txnTitle{font-weight:800}
  .txnSub{color:var(--muted);font-size:12px}
  .txnAmt{font-weight:800}

  /* Views positions */
  .pos-0 .views{transform:translateX(0%)}    /* main */
  .pos-1 .views{transform:translateX(-50%)}  /* txn details */

  /* Transaction details view */
  .txnHeader{padding:28px 18px 10px;text-align:center}
  .txnAmount{font-size:60px;font-weight:900;letter-spacing:-.5px}
  .txnMerchant{color:var(--muted);font-size:22px;font-weight:700;margin-top:6px}
  .txnDate{color:var(--muted);font-size:16px;margin-top:4px}
  .rowDetail{
    margin:14px 12px;display:flex;justify-content:space-between;align-items:center;
    padding:16px;background:var(--card);border:1px solid var(--divider);border-radius:14px
  }
  .rowDetail h3{margin:0;font-size:18px}
  .rowDetail .right{font-weight:900;font-size:18px}
  .dangerBtn{
    margin:20px 12px 24px;background:#2b0d0d;border:1px solid #8a1c1c;color:#ff6b6b;
    font-weight:900;border-radius:14px;padding:14px 16px;text-align:center;cursor:pointer
  }

  /* Bottom sheets (add txn + confirm) */
  .sheet{position:fixed;inset:0;display:grid;place-items:end center;pointer-events:none;z-index:9}
  .sheet.active{pointer-events:auto}
  .dim{position:absolute;inset:0;background:rgba(0,0,0,.45);opacity:0;transition:opacity var(--t)}
  .sheet.active .dim{opacity:1}
  .panel{width:100%;max-width:430px;background:#fff;color:#000;border-radius:20px 20px 0 0;
         transform:translateY(100%);transition:transform var(--t);box-shadow:0 -20px 40px rgba(0,0,0,.35)}
  .sheet.active .panel{transform:translateY(0)}
  .panelHead{display:flex;align-items:center;justify-content:center;padding:12px 14px 0;position:relative}
  .closeX{position:absolute;left:14px;top:8px;width:36px;height:36px;border-radius:10px;border:none;background:#efefef;font-size:20px;font-weight:900;cursor:pointer}
  .title{font-size:28px;font-weight:900;margin:6px 0 8px;text-align:center}
  .form{padding:10px 16px 18px}
  .f{margin-bottom:12px}
  .f label{display:block;font-size:13px;font-weight:800;margin:0 0 6px;color:#1f1f1f}
  .f input,.f select{
    width:100%;padding:12px 12px;border-radius:12px;border:1px solid #dcdcdc;font-size:16px
  }
  .actionsC{display:flex;justify-content:center;padding:0 16px 18px}
  .btnC{border-radius:14px;padding:14px 22px;font-weight:900;border:0}
  .primaryC{background:#34c759;color:#000;min-width:65%}
  .subtle{padding:0 0 18px;text-align:center;color:#007aff;font-weight:900}

</style>
</head>
<body>
<div class="app pos-0" id="app">
  <div class="views">

    <!-- MAIN VIEW -->
    <section class="view" id="mainView">
      <div class="nav">
        <h1 class="title">Savings</h1>
        <div class="iconrow">
          <div class="iconbtn" aria-label="Search"><svg viewBox="0 0 24 24" width="18" height="18" fill="#fff"><path opacity=".9" d="M15.5 14h-.79l-.28-.27a6.5 6.5 0 10-.7.7l.27.28v.79l5 4.99L20.49 19l-4.99-5zM9.5 14C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg></div>
          <!-- SECOND BUTTON = Add Transaction -->
          <div class="iconbtn" id="openAddTxn" aria-label="Add Transaction"><svg viewBox="0 0 24 24" width="18" height="18" fill="#fff"><path opacity=".9" d="M4 11h16v2H4zM11 4h2v16h-2z"/></svg></div>
          <div class="iconbtn" aria-label="More"><svg viewBox="0 0 24 24" width="18" height="18" fill="#fff"><circle cx="12" cy="5" r="2"/><circle cx="12" cy="12" r="2"/><circle cx="12" cy="19" r="2"/></svg></div>
        </div>
      </div>

      <!-- Summary + dropdown -->
      <div class="summary" id="summaryCard" tabindex="0" role="button" aria-expanded="false" aria-controls="acctPanel">
        <div class="row">
          <div>
            <div class="label">Current Balance</div>
            <div class="balance" id="currentBalance">$70.19</div>
          </div>
          <div class="apy" aria-label="Annual Percentage Yield">184% APY</div>
        </div>
      </div>
      <div class="acctPanel" id="acctPanel" aria-hidden="true">
        <div class="acctInner">
          <div class="kv">
            <div class="k">Account</div>
            <div class="v">102979124</div>
          </div>
          <div class="kv">
            <div class="k">Routing</div>
            <div class="v">072000326</div>
          </div>
        </div>
      </div>

      <!-- Actions -->
      <div class="actions">
        <div class="btn light">Withdraw</div>
        <div class="btn primary">Add Money</div>
      </div>

      <!-- Checking quick balance -->
      <div class="accountBtn" role="button" aria-label="Checking account balance">
        <div>Checking</div>
        <div class="right">$414.00</div>
      </div>

      <!-- Transactions -->
      <div class="sectionTitle">Latest Transactions</div>
      <div class="tile" id="txnsTile">
        <div class="txnList" id="txnList"></div>
      </div>
    </section>

    <!-- TRANSACTION DETAILS VIEW -->
    <section class="view" id="txnView">
      <div class="nav">
        <button class="btn light" id="backTxn" style="min-width:84px;border-radius:999px;padding:8px 14px;">Back</button>
        <div class="iconrow"></div>
      </div>

      <div class="txnHeader">
        <div class="txnAmount" id="txnAmount">+$0.00</div>
        <div class="txnMerchant" id="txnMerchant">Merchant</div>
        <div class="txnDate" id="txnDate">MM/DD/YY, 0:00 PM</div>
      </div>

      <div class="rowDetail">
        <h3>Account</h3>
        <div class="right" id="txnAccount">Savings</div>
      </div>
      <div class="rowDetail">
        <h3>Total</h3>
        <div class="right" id="txnTotal">+$0.00</div>
      </div>

      <div class="dangerBtn" id="deleteTxnBtn">Delete Transaction</div>
    </section>

  </div>

  <!-- ADD TRANSACTION SHEET -->
  <div class="sheet" id="addTxnSheet">
    <div class="dim" id="dimAdd"></div>
    <div class="panel">
      <div class="panelHead"><button class="closeX" id="closeAdd" aria-label="Close">×</button></div>
      <div class="title">New Transaction</div>
      <div class="form">
        <div class="f">
          <label for="inMerchant">Merchant</label>
          <input id="inMerchant" type="text" placeholder="Who or what?" />
        </div>
        <div class="f">
          <label for="inAmount">Amount</label>
          <input id="inAmount" type="number" step="0.01" inputmode="decimal" placeholder="0.00" />
        </div>
        <div class="f">
          <label for="inDate">Date &amp; Time</label>
          <input id="inDate" type="datetime-local" />
        </div>
        <div class="f">
          <label for="inType">Type</label>
          <select id="inType">
            <option value="Credit">Credit (+)</option>
            <option value="Debit">Debit (-)</option>
          </select>
        </div>
      </div>
      <div class="actionsC">
        <button class="btnC primaryC" id="continueAdd">Continue</button>
      </div>
      <div class="subtle" id="cancelAdd">Cancel</div>
    </div>
  </div>

  <!-- CONFIRM SHEET -->
  <div class="sheet" id="confirmSheet">
    <div class="dim" id="dimConfirm"></div>
    <div class="panel">
      <div class="panelHead"><button class="closeX" id="closeConfirm" aria-label="Close">×</button></div>
      <div class="title">Confirm Transaction</div>
      <div class="form" id="confirmBody">
        <!-- filled by JS -->
      </div>
      <div class="actionsC">
        <button class="btnC primaryC" id="addNowBtn">Add Transaction</button>
      </div>
      <div class="subtle" id="editBack">Edit</div>
    </div>
  </div>
</div>

<script>
(()=> {
  const app=document.getElementById('app');

  /* ===== Expand/Collapse account numbers ===== */
  const summary = document.getElementById('summaryCard');
  const panel   = document.getElementById('acctPanel');
  function openPanel(){
    summary.classList.add('open');
    panel.classList.add('open');
    panel.style.maxHeight = panel.scrollHeight + 'px';
    panel.setAttribute('aria-hidden','false');
    summary.setAttribute('aria-expanded','true');
  }
  function closePanel(){
    summary.classList.remove('open');
    panel.classList.remove('open');
    panel.style.maxHeight = '0px';
    panel.setAttribute('aria-hidden','true');
    summary.setAttribute('aria-expanded','false');
  }
  function toggle(){ panel.classList.contains('open') ? closePanel() : openPanel(); }
  summary.addEventListener('click', toggle);
  summary.addEventListener('keydown', e=>{ if(e.key==='Enter'||e.key===' '){e.preventDefault(); toggle(); }});
  window.addEventListener('resize', ()=>{ if(panel.classList.contains('open')) panel.style.maxHeight = panel.scrollHeight + 'px'; });

  /* ===== Transactions storage ===== */
  const TXN_KEY = 'savings_txns';
  function rid(){ return 't_'+Math.random().toString(36).slice(2,9) }
  function loadTx(){
    try{ const raw = localStorage.getItem(TXN_KEY); const arr = JSON.parse(raw); if(Array.isArray(arr)) return arr; }catch(e){}
    return []; // start empty
  }
  let transactions = loadTx();
  function saveTx(){ try{ localStorage.setItem(TXN_KEY, JSON.stringify(transactions)); }catch(e){} }

  /* ===== Formatting ===== */
  const txnListEl = document.getElementById('txnList');
  const shortDate = iso => {
    const d = new Date(iso);
    return d.toLocaleDateString(undefined,{month:'2-digit',day:'2-digit',year:'2-digit'});
  };
  const fullDateTime = iso => {
    const d = new Date(iso);
    return d.toLocaleDateString(undefined,{month:'2-digit',day:'2-digit',year:'2-digit'}) + ', ' +
           d.toLocaleTimeString(undefined,{hour:'numeric',minute:'2-digit'});
  };

  const isCredit = type => (type || '').toLowerCase() === 'credit';
  function fmtSignedUSD(n, type){
    const sign = isCredit(type) ? '+' : '-';
    return sign + '$' + Number(Math.abs(n)).toFixed(2);
  }

  function getType(t){
    // Back-compat if older "status" exists
    if (t.type) return t.type;
    if (t.status) return (t.status === 'Approved') ? 'Credit' : 'Debit';
    return 'Credit';
  }

  function renderTransactions(){
    // newest on top (later date first)
    transactions.sort((a,b)=> new Date(b.iso) - new Date(a.iso));
    if (transactions.length === 0){
      txnListEl.innerHTML = `<div class="txnRow" style="justify-content:center;opacity:.7;cursor:default">No transactions yet</div>`;
      return;
    }
    txnListEl.innerHTML = transactions.map(t => {
      const type = getType(t);
      return `
      <div class="txnRow" data-id="${t.id}" tabindex="0" role="button" aria-label="Open ${t.merchant} transaction">
        <div class="txnMain">
          <div class="txnTitle">${t.merchant}${type ? ` <span style="opacity:.6">• ${type}</span>` : ''}</div>
          <div class="txnSub">${shortDate(t.iso)}</div>
        </div>
        <div class="txnAmt">${fmtSignedUSD(t.amount, type)}</div>
      </div>`;
    }).join('');

    txnListEl.querySelectorAll('.txnRow').forEach(row=>{
      const id = row.dataset.id;
      if (!id) return;
      row.addEventListener('click',()=>openTxn(id));
      row.addEventListener('keypress',e=>{ if(e.key==='Enter') openTxn(id) });
    });
  }

  /* ===== Details view ===== */
  const backBtn = document.getElementById('backTxn');
  const delBtn  = document.getElementById('deleteTxnBtn');
  let openId = null;

  function openTxn(id){
    const t = transactions.find(x=>x.id===id);
    if(!t) return;
    openId = id;
    const type = getType(t);
    document.getElementById('txnAmount').textContent  = fmtSignedUSD(t.amount, type);
    document.getElementById('txnMerchant').textContent= t.merchant;
    document.getElementById('txnDate').textContent    = fullDateTime(t.iso);
    document.getElementById('txnAccount').textContent = 'Savings';
    document.getElementById('txnTotal').textContent   = fmtSignedUSD(t.amount, type);
    app.className='app pos-1';
  }
  backBtn.addEventListener('click', ()=>{ app.className='app pos-0'; });

  delBtn.addEventListener('click', ()=>{
    if(!openId) return;
    const i = transactions.findIndex(t=>t.id===openId);
    if(i>-1){ transactions.splice(i,1); saveTx(); renderTransactions(); }
    app.className='app pos-0';
  });

  /* ===== Add Transaction flow (two-sheet flow) ===== */
  const addSheet = document.getElementById('addTxnSheet');
  const confirmSheet = document.getElementById('confirmSheet');
  const openAdd = document.getElementById('openAddTxn');
  const closeAdd = ()=>addSheet.classList.remove('active');
  const closeConfirm = ()=>confirmSheet.classList.remove('active');

  // open sheet
  openAdd.addEventListener('click', ()=>{
    // default datetime-local now
    const now = new Date();
    const pad = n=>String(n).padStart(2,'0');
    const val = `${now.getFullYear()}-${pad(now.getMonth()+1)}-${pad(now.getDate())}T${pad(now.getHours())}:${pad(now.getMinutes())}`;
    document.getElementById('inDate').value = val;
    addSheet.classList.add('active');
  });
  document.getElementById('closeAdd').addEventListener('click', closeAdd);
  document.getElementById('cancelAdd').addEventListener('click', closeAdd);
  document.getElementById('dimAdd').addEventListener('click', closeAdd);

  // Continue -> confirm
  document.getElementById('continueAdd').addEventListener('click', ()=>{
    const merchant = (document.getElementById('inMerchant').value || '').trim() || 'Merchant';
    const amount   = parseFloat(document.getElementById('inAmount').value||'0');
    const isoRaw   = document.getElementById('inDate').value;
    const iso      = isoRaw ? new Date(isoRaw).toISOString() : new Date().toISOString();
    const type     = document.getElementById('inType').value;

    // stash on dataset for confirm
    confirmSheet.dataset.merchant = merchant;
    confirmSheet.dataset.amount   = String(isFinite(amount)?amount:0);
    confirmSheet.dataset.iso      = iso;
    confirmSheet.dataset.type     = type;

    document.getElementById('confirmBody').innerHTML = `
      <div class="f"><label>Merchant</label><div style="font-weight:900">${merchant}</div></div>
      <div class="f"><label>Amount</label><div style="font-weight:900">${fmtSignedUSD(amount, type)}</div></div>
      <div class="f"><label>Date &amp; Time</label><div style="font-weight:900">${fullDateTime(iso)}</div></div>
      <div class="f"><label>Type</label><div style="font-weight:900">${type}</div></div>
    `;
    addSheet.classList.remove('active');
    confirmSheet.classList.add('active');
  });

  document.getElementById('closeConfirm').addEventListener('click', closeConfirm);
  document.getElementById('editBack').addEventListener('click', ()=>{
    confirmSheet.classList.remove('active');
    addSheet.classList.add('active');
  });
  document.getElementById('dimConfirm').addEventListener('click', closeConfirm);

  // Finalize add
  document.getElementById('addNowBtn').addEventListener('click', ()=>{
    const merchant = confirmSheet.dataset.merchant || 'Merchant';
    const amount   = Number(confirmSheet.dataset.amount || '0');
    const iso      = confirmSheet.dataset.iso || new Date().toISOString();
    const type     = confirmSheet.dataset.type || 'Credit';

    transactions.push({ id: rid(), merchant, amount, iso, type });
    saveTx();
    renderTransactions();
    closeConfirm();
  });

  /* Init render */
  renderTransactions();
})();
</script>
</body>
</html>
